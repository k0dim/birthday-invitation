name: üöÄ Production Deployment Pipeline

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:  # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫
    inputs:
      environment:
        description: 'Environment to deploy to'
        required: true
        default: 'production'
        type: choice
        options:
          - production
          - staging
      force:
        description: 'Force deployment (skip tests)'
        required: false
        default: false
        type: boolean

# –û—Ç–º–µ–Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –∑–∞–ø—É—Å–∫–æ–≤ —Ç–æ–≥–æ –∂–µ workflow
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

env:
  # Global environment variables
  APP_NAME: 'birthday-invitation'
  NODE_VERSION: '20'
  PNPM_VERSION: '8'
  
  # Deployment paths
  DEPLOY_USER: ${{ secrets.DEPLOY_USER }}
  DEPLOY_PATH: '/var/www/birthday-invitation'
  BACKUP_PATH: '/var/backups/birthday-invitation'
  
  # Nginx
  NGINX_SITES_AVAILABLE: '/etc/nginx/sites-available'
  NGINX_SITES_ENABLED: '/etc/nginx/sites-enabled'
  NGINX_SITE_NAME: 'birthday-invitation'

jobs:
  # ==================== VALIDATION ====================
  validate:
    name: üîç Validate
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
    
    - name: Validate branch protection
      if: github.event_name == 'push'
      run: |
        echo "üîí Validating branch: ${{ github.ref }}"
        if [[ "${{ github.ref }}" != "refs/heads/main" && "${{ github.ref }}" != "refs/heads/master" ]]; then
          echo "‚ö†Ô∏è  Only main/master branches can be deployed to production"
          exit 1
        fi
    
    - name: Validate secrets
      run: |
        echo "üîê Validating required secrets..."
        required_secrets=(
          "TELEGRAM_BOT_TOKEN"
          "TELEGRAM_CHAT_ID"
          "SERVER_IP"
          "DEPLOY_USER"
          "SSH_PRIVATE_KEY"
          "DOMAIN"
        )
        
        for secret in "${required_secrets[@]}"; do
          if [ -z "${secret}" ]; then
            echo "‚ùå Missing secret: $secret"
            exit 1
          else
            echo "‚úÖ $secret: Configured"
          fi
        done
        
        echo "‚úÖ All secrets validated"
    
    - name: Validate package.json
      run: |
        echo "üì¶ Validating package.json..."
        if [ ! -f "package.json" ]; then
          echo "‚ùå package.json not found"
          exit 1
        fi
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
        jq -e '.name' package.json > /dev/null || (echo "‚ùå Missing name in package.json" && exit 1)
        jq -e '.version' package.json > /dev/null || (echo "‚ùå Missing version in package.json" && exit 1)
        jq -e '.scripts.build' package.json > /dev/null || (echo "‚ùå Missing build script in package.json" && exit 1)
        
        echo "‚úÖ package.json is valid"
    
    - name: Code quality check
      run: |
        echo "üìù Checking code quality..."
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
        required_files=(
          "src/App.jsx"
          "src/main.jsx"
          "src/index.css"
          "index.html"
          "vite.config.js"
        )
        
        for file in "${required_files[@]}"; do
          if [ ! -f "$file" ]; then
            echo "‚ö†Ô∏è  Missing recommended file: $file"
          fi
        done
        
        # –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç—ã–µ —Ñ–∞–π–ª—ã
        find src -name "*.jsx" -o -name "*.js" | while read file; do
          if [ ! -s "$file" ]; then
            echo "‚ö†Ô∏è  Empty file: $file"
          fi
        done
        
        echo "‚úÖ Code quality check passed"

  # ==================== SECURITY SCAN ====================
  security:
    name: üîí Security Scan
    runs-on: ubuntu-latest
    needs: validate
    timeout-minutes: 10
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Dependency audit
      run: |
        echo "üõ°Ô∏è  Running dependency audit..."
        npm audit --audit-level=moderate || echo "‚ö†Ô∏è  Audit found vulnerabilities"
    
    - name: Check for exposed secrets
      run: |
        echo "üîç Checking for exposed secrets..."
        # –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–ª—É—á–∞–π–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ –∫–æ–¥–µ
        forbidden_patterns=(
          "password.*="
          "token.*="
          "secret.*="
          "api[_-]key"
          "ssh[_-]key"
          "private[_-]key"
        )
        
        for pattern in "${forbidden_patterns[@]}"; do
          echo "Checking pattern: $pattern"
          if grep -r -i "$pattern" --include="*.js" --include="*.jsx" --include="*.json" --include="*.env*" . | grep -v "node_modules" | grep -v ".git"; then
            echo "‚ö†Ô∏è  Potential secret found with pattern: $pattern"
          fi
        done
        
        echo "‚úÖ Secret scan completed"
    
    - name: Check environment files
      run: |
        echo "üìÅ Checking environment files..."
        # –£–±–µ–¥–∏–º—Å—è —á—Ç–æ .env.local –Ω–µ –∑–∞–∫–æ–º–º–∏—á–µ–Ω
        if [ -f ".env.local" ]; then
          echo "‚ùå .env.local should not be committed to repository!"
          exit 1
        fi
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ .env.example
        if [ ! -f ".env.example" ]; then
          echo "‚ùå .env.example is missing!"
          exit 1
        fi
        
        echo "‚úÖ Environment files check passed"

  # ==================== BUILD ====================
  build:
    name: üèóÔ∏è Build
    runs-on: ubuntu-latest
    needs: [validate, security]
    timeout-minutes: 15
    outputs:
      version: ${{ steps.extract_version.outputs.version }}
      build_id: ${{ steps.generate_build_id.outputs.build_id }}
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: ${{ env.NODE_VERSION }}
        cache: 'npm'
    
    - name: Setup pnpm (optional)
      uses: pnpm/action-setup@v2
      with:
        version: ${{ env.PNPM_VERSION }}
    
    - name: Extract version
      id: extract_version
      run: |
        VERSION=$(node -p "require('./package.json').version")
        echo "version=$VERSION" >> $GITHUB_OUTPUT
        echo "üì¶ Version: $VERSION"
    
    - name: Generate build ID
      id: generate_build_id
      run: |
        BUILD_ID="${GITHUB_SHA:0:7}-$(date +%Y%m%d%H%M%S)"
        echo "build_id=$BUILD_ID" >> $GITHUB_OUTPUT
        echo "üè∑Ô∏è Build ID: $BUILD_ID"
    
    - name: Install dependencies
      run: |
        echo "üì¶ Installing dependencies..."
        npm ci --prefer-offline --no-audit
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
        echo "Dependencies installed:"
        npm list --depth=0
    
    - name: Build application
      env:
        VITE_TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        VITE_TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        VITE_APP_VERSION: ${{ steps.extract_version.outputs.version }}
        VITE_BUILD_ID: ${{ steps.generate_build_id.outputs.build_id }}
        VITE_BUILD_DATE: $(date -u +"%Y-%m-%dT%H:%M:%SZ")
        VITE_COMMIT_SHA: ${{ github.sha }}
        VITE_ENVIRONMENT: production
      run: |
        echo "üöÄ Building application with environment variables..."
        echo "Version: $VITE_APP_VERSION"
        echo "Build ID: $VITE_BUILD_ID"
        echo "Commit: $VITE_COMMIT_SHA"
        
        # –°–±–æ—Ä–∫–∞
        npm run build
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–±–æ—Ä–∫–∏
        echo "üìÅ Build output:"
        ls -la dist/
        du -sh dist/
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ index.html
        if [ ! -f "dist/index.html" ]; then
          echo "‚ùå dist/index.html not found!"
          exit 1
        fi
    
    - name: Run tests
      if: ${{ !inputs.force || github.event.inputs.force != 'true' }}
      run: |
        echo "üß™ Running tests..."
        # –ï—Å–ª–∏ –µ—Å—Ç—å —Ç–µ—Å—Ç—ã
        if [ -f "package.json" ] && jq -e '.scripts.test' package.json > /dev/null; then
          npm test
        else
          echo "‚ö†Ô∏è  No tests configured, skipping..."
        fi
    
    - name: Create build manifest
      run: |
        echo "üìÑ Creating build manifest..."
        
        cat > dist/build-manifest.json << EOF
        {
          "application": "birthday-invitation",
          "version": "${{ steps.extract_version.outputs.version }}",
          "buildId": "${{ steps.generate_build_id.outputs.build_id }}",
          "commitSha": "${{ github.sha }}",
          "commitMessage": "${{ github.event.head_commit.message }}",
          "branch": "${{ github.ref_name }}",
          "builtAt": "$(date -u +"%Y-%m-%dT%H:%M:%SZ")",
          "builtBy": "${{ github.actor }}",
          "environment": "production"
        }
        EOF
        
        echo "‚úÖ Build manifest created"
    
    - name: Upload build artifacts
      uses: actions/upload-artifact@v4
      with:
        name: build-${{ steps.generate_build_id.outputs.build_id }}
        path: |
          dist/
          package.json
          package-lock.json
        retention-days: 30
        if-no-files-found: error

  # ==================== DEPLOY ====================
  deploy:
    name: üöÄ Deploy to Production
    runs-on: ubuntu-latest
    needs: [build]
    if: github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master' || github.event_name == 'workflow_dispatch'
    timeout-minutes: 30
    environment: 
      name: production
      url: https://${{ vars.DOMAIN }}
    
    steps:
    - name: Download build artifacts
      uses: actions/download-artifact@v4
      with:
        name: build-${{ needs.build.outputs.build_id }}
    
    - name: Setup SSH with advanced configuration
      run: |
        echo "üîê Setting up SSH connection..."
        
        # –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∏ –∫–ª—é—á
        mkdir -p ~/.ssh
        echo "${{ secrets.SSH_PRIVATE_KEY }}" > ~/.ssh/deploy_key
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç –∫–ª—é—á–∞
        echo "üîç Validating SSH key..."
        head -1 ~/.ssh/deploy_key
        tail -1 ~/.ssh/deploy_key
        
        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∞
        chmod 600 ~/.ssh/deploy_key
        
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        ssh-keygen -y -f ~/.ssh/deploy_key > ~/.ssh/deploy_key.pub
        echo "Public key fingerprint:"
        ssh-keygen -l -f ~/.ssh/deploy_key
        
        # –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
        cat >> ~/.ssh/config << EOF
        Host deploy-server
          HostName ${{ secrets.SERVER_IP }}
          User ${{ env.DEPLOY_USER }}
          IdentityFile ~/.ssh/deploy_key
          Port 22
          StrictHostKeyChecking no
          UserKnownHostsFile /dev/null
          ConnectTimeout 30
          ServerAliveInterval 60
          ServerAliveCountMax 3
          LogLevel ERROR
        EOF
        
        chmod 600 ~/.ssh/config
        
        echo "‚úÖ SSH setup completed"
    
    - name: Verify server connectivity
      run: |
        echo "üîç Testing server connectivity..."
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–∑–æ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
        ssh deploy-server "echo '‚úÖ SSH connection successful!'"
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
        ssh deploy-server "
          echo '=== Server Information ==='
          echo 'Hostname: \$(hostname)'
          echo 'Uptime: \$(uptime -p)'
          echo 'OS: \$(lsb_release -d | cut -f2)'
          echo 'Kernel: \$(uname -r)'
          echo ''
          echo '=== Disk Space ==='
          df -h /var /home
          echo ''
          echo '=== Memory ==='
          free -h
          echo ''
          echo '=== Nginx Status ==='
          if command -v nginx &> /dev/null; then
            nginx -v
            sudo systemctl is-active nginx
          else
            echo '‚ùå Nginx not installed'
          fi
        "
    
    - name: Create backup before deployment
      run: |
        echo "üíæ Creating backup..."
        
        TIMESTAMP=$(date +%Y%m%d_%H%M%S)
        BACKUP_NAME="birthday-invitation_backup_$TIMESTAMP.tar.gz"
        
        ssh deploy-server "
          echo 'Creating backup of current deployment...'
          
          # –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –±—ç–∫–∞–ø–æ–≤ –µ—Å–ª–∏ –Ω–µ—Ç
          sudo mkdir -p ${{ env.BACKUP_PATH }}
          
          # –°–æ–∑–¥–∞–µ–º –±—ç–∫–∞–ø —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏
          if [ -d \"${{ env.DEPLOY_PATH }}/dist\" ]; then
            sudo tar -czf \"${{ env.BACKUP_PATH }}/$BACKUP_NAME\" -C \"${{ env.DEPLOY_PATH }}\" dist/
            echo \"‚úÖ Backup created: $BACKUP_NAME\"
            echo \"Backup size: \$(du -h ${{ env.BACKUP_PATH }}/$BACKUP_NAME | cut -f1)\"
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –±—ç–∫–∞–ø–æ–≤
            echo 'Cleaning old backups (keeping last 5)...'
            sudo ls -t ${{ env.BACKUP_PATH }}/birthday-invitation_backup_*.tar.gz 2>/dev/null | tail -n +6 | sudo xargs -r rm
            echo 'Current backups:'
            sudo ls -lh ${{ env.BACKUP_PATH }}/birthday-invitation_backup_*.tar.gz 2>/dev/null || echo 'No previous backups'
          else
            echo '‚ö†Ô∏è  No existing deployment found, skipping backup'
          fi
        "
    
    - name: Prepare deployment directory
      run: |
        echo "üìÅ Preparing deployment directory..."
        
        ssh deploy-server "
          # –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –µ—Å–ª–∏ –Ω–µ—Ç
          sudo mkdir -p ${{ env.DEPLOY_PATH }}
          sudo chown -R ${{ env.DEPLOY_USER }}:${{ env.DEPLOY_USER }} ${{ env.DEPLOY_PATH }}
          
          # –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
          mkdir -p ${{ env.DEPLOY_PATH }}/dist
          mkdir -p ${{ env.DEPLOY_PATH }}/logs
          mkdir -p ${{ env.DEPLOY_PATH }}/config
          
          # –°–æ–∑–¥–∞–µ–º —Å–∏–º–ª–∏–Ω–∫ –¥–ª—è —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏
          ln -sfn ${{ env.DEPLOY_PATH }}/dist ${{ env.DEPLOY_PATH }}/current
          
          echo 'Directory structure:'
          ls -la ${{ env.DEPLOY_PATH }}/
        "
    
    - name: Deploy application files
      run: |
        echo "üì§ Deploying application files..."
        
        # –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –¥–µ–ø–ª–æ—è
        DEPLOY_TEMP_DIR="/tmp/deploy_${{ needs.build.outputs.build_id }}"
        mkdir -p $DEPLOY_TEMP_DIR
        
        # –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã —Å–±–æ—Ä–∫–∏
        cp -r dist/* $DEPLOY_TEMP_DIR/
        
        # –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª –≤–µ—Ä—Å–∏–∏
        echo "${{ needs.build.outputs.build_id }}" > $DEPLOY_TEMP_DIR/.version
        
        # –ö–æ–ø–∏—Ä—É–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        echo "Copying files to server..."
        scp -r $DEPLOY_TEMP_DIR/* deploy-server:${{ env.DEPLOY_PATH }}/dist/
        
        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞
        ssh deploy-server "
          echo 'Setting file permissions...'
          sudo chown -R www-data:www-data ${{ env.DEPLOY_PATH }}/dist
          sudo find ${{ env.DEPLOY_PATH }}/dist -type f -exec chmod 644 {} \;
          sudo find ${{ env.DEPLOY_PATH }}/dist -type d -exec chmod 755 {} \;
          
          echo 'Deployed files:'
          ls -la ${{ env.DEPLOY_PATH }}/dist/ | head -15
          echo ''
          echo 'Total size:'
          du -sh ${{ env.DEPLOY_PATH }}/dist/
        "
        
        # –û—á–∏—â–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
        rm -rf $DEPLOY_TEMP_DIR
        
        echo "‚úÖ Files deployed successfully"
    
    - name: Setup SSL with Let's Encrypt
      run: |
        echo "üîê Setting up SSL with Let's Encrypt..."
        
        # –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç–æ–π HTTP –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è certbot
        cat > nginx-http.conf << 'EOF'
        server {
            listen 80;
            server_name $DOMAIN www.$DOMAIN;
            root $DEPLOY_PATH/dist;
            index index.html;
            
            location /.well-known/acme-challenge/ {
                root /var/www/html;
            }
            
            location / {
                try_files $uri $uri/ /index.html;
            }
        }
        EOF
        
        # –ó–∞–º–µ–Ω—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ –∫–æ–Ω—Ñ–∏–≥–µ
        sed -i "s|\$DOMAIN|${{ secrets.DOMAIN }}|g" nginx-http.conf
        sed -i "s|\$DEPLOY_PATH|${{ env.DEPLOY_PATH }}|g" nginx-http.conf
        
        # –ö–æ–ø–∏—Ä—É–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        scp nginx-http.conf deploy-server:/tmp/nginx-http.conf
        
        # –í—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
        ssh deploy-server << 'REMOTE_EOF'
          echo "üì¶ Preparing for Let's Encrypt..."
          
          # –û—Ç–∫–ª—é—á–∞–µ–º —Ç–µ–∫—É—â–∏–π —Å–∞–π—Ç
          sudo rm -f /etc/nginx/sites-enabled/birthday-invitation 2>/dev/null || true
          
          # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π HTTP –∫–æ–Ω—Ñ–∏–≥
          sudo cp /tmp/nginx-http.conf /etc/nginx/sites-available/birthday-invitation
          sudo ln -sf /etc/nginx/sites-available/birthday-invitation /etc/nginx/sites-enabled/
          
          # –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º nginx
          sudo nginx -t && sudo systemctl reload nginx
          echo "‚úÖ Temporary HTTP config applied"
          
          # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º certbot –µ—Å–ª–∏ –Ω–µ—Ç
          if ! command -v certbot &> /dev/null; then
            echo "Installing certbot..."
            sudo apt-get update
            sudo apt-get install -y certbot python3-certbot-nginx
          fi
          
          # –ü–æ–ª—É—á–∞–µ–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
          echo "üìù Obtaining SSL certificate..."
          sudo certbot --nginx --non-interactive --agree-tos \
            --email admin@${{ secrets.DOMAIN }} \
            -d ${{ secrets.DOMAIN }} \
            -d www.${{ secrets.DOMAIN }} \
            --redirect || echo "‚ö†Ô∏è Certbot failed, will use HTTP"
          
          echo "‚úÖ Let's Encrypt setup attempted"
        REMOTE_EOF
        
        rm -f nginx-http.conf

    - name: Configure final Nginx
      run: |
        echo "‚öôÔ∏è  Configuring final Nginx..."
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
        SSL_STATUS=$(ssh deploy-server "if [ -f /etc/letsencrypt/live/${{ secrets.DOMAIN }}/fullchain.pem ]; then echo 'ssl'; else echo 'http'; fi")
        
        if [ "$SSL_STATUS" = "ssl" ]; then
          echo "‚úÖ SSL certificate found, configuring HTTPS..."
          
          # –°–æ–∑–¥–∞–µ–º SSL –∫–æ–Ω—Ñ–∏–≥ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º EOF
          cat << 'NGINX_SSL_EOF' > nginx-ssl.conf
          server {
              listen 80;
              server_name __DOMAIN__ www.__DOMAIN__;
              return 301 https://$server_name$request_uri;
          }
          
          server {
              listen 443 ssl http2;
              server_name __DOMAIN__ www.__DOMAIN__;
              
              ssl_certificate /etc/letsencrypt/live/__DOMAIN__/fullchain.pem;
              ssl_certificate_key /etc/letsencrypt/live/__DOMAIN__/privkey.pem;
              
              root __DEPLOY_PATH__/dist;
              index index.html;
              
              # Security headers
              add_header X-Frame-Options "SAMEORIGIN" always;
              add_header X-Content-Type-Options "nosniff" always;
              
              # SPA routing
              location / {
                  try_files $uri $uri/ /index.html;
              }
              
              # Static assets
              location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|webp)$ {
                  expires 1y;
                  add_header Cache-Control "public, immutable";
                  access_log off;
              }
              
              location /health { return 200 "healthy\n"; }
              location /version { alias __DEPLOY_PATH__/dist/.version; }
          }
          NGINX_SSL_EOF
          
          CONFIG_FILE="nginx-ssl.conf"
        else
          echo "‚ö†Ô∏è  No SSL certificate, using HTTP only"
          
          # –°–æ–∑–¥–∞–µ–º HTTP –∫–æ–Ω—Ñ–∏–≥
          cat << 'NGINX_HTTP_EOF' > nginx-http-only.conf
          server {
              listen 80;
              server_name __DOMAIN__ www.__DOMAIN__;
              
              root __DEPLOY_PATH__/dist;
              index index.html;
              
              add_header X-Frame-Options "SAMEORIGIN" always;
              add_header X-Content-Type-Options "nosniff" always;
              
              location / {
                  try_files $uri $uri/ /index.html;
              }
              
              location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|webp)$ {
                  expires 1y;
                  add_header Cache-Control "public, immutable";
                  access_log off;
              }
              
              location /health { return 200 "healthy\n"; }
              location /version { alias __DEPLOY_PATH__/dist/.version; }
          }
          NGINX_HTTP_EOF
          
          CONFIG_FILE="nginx-http-only.conf"
        fi
        
        # –ó–∞–º–µ–Ω—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        sed -i "s|__DOMAIN__|${{ secrets.DOMAIN }}|g" "$CONFIG_FILE"
        sed -i "s|__DEPLOY_PATH__|${{ env.DEPLOY_PATH }}|g" "$CONFIG_FILE"
        
        # –ö–æ–ø–∏—Ä—É–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        scp "$CONFIG_FILE" deploy-server:/tmp/nginx-final.conf
        
        # –ü—Ä–∏–º–µ–Ω—è–µ–º –∫–æ–Ω—Ñ–∏–≥
        ssh deploy-server '
          sudo cp /tmp/nginx-final.conf /etc/nginx/sites-available/birthday-invitation
          sudo ln -sf /etc/nginx/sites-available/birthday-invitation /etc/nginx/sites-enabled/
          sudo rm -f /etc/nginx/sites-enabled/default 2>/dev/null || true
          sudo nginx -t && sudo systemctl reload nginx
          echo "‚úÖ Nginx configured successfully"
        '
        
        rm -f "$CONFIG_FILE"

    - name: Configure Nginx (if Let's Encrypt failed)
      if: failure()
      run: |
        echo "‚öôÔ∏è  Configuring Nginx with self-signed certificate..."
        
        ssh deploy-server "
          # –°–æ–∑–¥–∞–µ–º —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–Ω–æ–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
          echo 'üîê Generating self-signed certificate...'
          sudo mkdir -p /etc/ssl/certs
          sudo mkdir -p /etc/ssl/private
          
          sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
            -keyout /etc/ssl/private/birthday-invitation.key \
            -out /etc/ssl/certs/birthday-invitation.crt \
            -subj \"/C=RU/ST=Moscow/L=Moscow/O=Birthday/CN=${{ secrets.DOMAIN }}\"
          
          sudo chmod 644 /etc/ssl/certs/birthday-invitation.crt
          sudo chmod 600 /etc/ssl/private/birthday-invitation.key
          
          echo '‚úÖ Self-signed certificate created'
        "
        
        # –°–æ–∑–¥–∞–µ–º Nginx –∫–æ–Ω—Ñ–∏–≥ —Å —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–Ω—ã–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º
        cat > nginx-selfsigned.conf << EOF
        # Birthday Invitation Application
        # Generated: $(date)
        # Build: ${{ needs.build.outputs.build_id }}
        
        server {
            listen 80;
            server_name ${{ secrets.DOMAIN }} www.${{ secrets.DOMAIN }};
            return 301 https://\$server_name\$request_uri;
        }
        
        server {
            listen 443 ssl http2;
            server_name ${{ secrets.DOMAIN }} www.${{ secrets.DOMAIN }};
            
            # SSL Configuration (self-signed)
            ssl_certificate /etc/ssl/certs/birthday-invitation.crt;
            ssl_certificate_key /etc/ssl/private/birthday-invitation.key;
            ssl_protocols TLSv1.2 TLSv1.3;
            ssl_ciphers 'ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305';
            ssl_prefer_server_ciphers off;
            ssl_session_cache shared:SSL:10m;
            ssl_session_timeout 10m;
            
            # Security Headers
            add_header X-Frame-Options "SAMEORIGIN" always;
            add_header X-Content-Type-Options "nosniff" always;
            add_header X-XSS-Protection "1; mode=block" always;
            add_header Referrer-Policy "strict-origin-when-cross-origin" always;
            add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
            
            # Root directory
            root ${{ env.DEPLOY_PATH }}/dist;
            index index.html;
            
            # Logging
            access_log ${{ env.DEPLOY_PATH }}/logs/nginx-access.log;
            error_log ${{ env.DEPLOY_PATH }}/logs/nginx-error.log;
            
            # Gzip Compression
            gzip on;
            gzip_vary on;
            gzip_min_length 1024;
            gzip_types text/plain text/css text/xml text/javascript application/javascript application/xml+rss application/json;
            
            # SPA routing
            location / {
                try_files \$uri \$uri/ /index.html;
                expires -1;
            }
            
            # Cache static assets
            location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|webp)$ {
                expires 1y;
                add_header Cache-Control "public, immutable";
                access_log off;
            }
            
            # Health check endpoint
            location /health {
                access_log off;
                return 200 "healthy\n";
                add_header Content-Type text/plain;
            }
            
            # Version endpoint
            location /version {
                alias ${{ env.DEPLOY_PATH }}/dist/.version;
                access_log off;
                add_header Content-Type text/plain;
            }
            
            # Block access to sensitive files
            location ~ /\. {
                deny all;
                access_log off;
                log_not_found off;
            }
            
            location ~* \.(log|sql|db|bak|old|orig)$ {
                deny all;
                access_log off;
                log_not_found off;
            }
            
            # Custom error pages
            error_page 404 /index.html;
            error_page 500 502 503 504 /50x.html;
            location = /50x.html {
                root /usr/share/nginx/html;
            }
        }
        EOF
        
        scp nginx-selfsigned.conf deploy-server:/tmp/nginx-selfsigned.conf
        
        ssh deploy-server "
          echo 'Applying Nginx configuration with self-signed certificate...'
          
          # –û—Ç–∫–ª—é—á–∞–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π —Å–∞–π—Ç
          sudo rm -f ${{ env.NGINX_SITES_ENABLED }}/default 2>/dev/null || true
          
          # –ü—Ä–∏–º–µ–Ω—è–µ–º –∫–æ–Ω—Ñ–∏–≥
          sudo cp /tmp/nginx-selfsigned.conf ${{ env.NGINX_SITES_AVAILABLE }}/${{ env.NGINX_SITE_NAME }}
          sudo ln -sf ${{ env.NGINX_SITES_AVAILABLE }}/${{ env.NGINX_SITE_NAME }} ${{ env.NGINX_SITES_ENABLED }}/
          
          # –¢–µ—Å—Ç–∏—Ä—É–µ–º –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º
          sudo nginx -t && sudo systemctl reload nginx
          echo '‚úÖ Nginx configured with self-signed certificate'
        "
        
        rm -f nginx-selfsigned.conf
    
    - name: Verify deployment
      run: |
        echo "üîç Verifying deployment..."
        
        # –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ —á—Ç–æ–±—ã nginx –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏–ª—Å—è
        sleep 5
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        echo "Testing application availability..."
        
        ssh deploy-server "
          echo '=== Local curl test ==='
          curl -s -o /dev/null -w '%{http_code}' https://localhost/health
          echo ' - Health check'
          
          curl -s -o /dev/null -w '%{http_code}' https://localhost/
          echo ' - Home page'
          
          curl -s https://localhost/version
          echo ' - Version'
          
          echo ''
          echo '=== Deployment verification ==='
          echo 'Build ID deployed:'
          cat ${{ env.DEPLOY_PATH }}/dist/.version 2>/dev/null || echo 'Not found'
          
          echo ''
          echo '=== Nginx verification ==='
          sudo nginx -t 2>&1
          echo ''
          sudo systemctl status nginx --no-pager | grep -E '(Active|Main PID|Status)'
          
          echo ''
          echo '=== Disk usage ==='
          df -h ${{ env.DEPLOY_PATH }}
        "
        
        # –í–Ω–µ—à–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        echo "=== External verification ==="
        echo "Application should be available at:"
        echo "  ‚Ä¢ https://${{ secrets.DOMAIN }}"
        echo "  ‚Ä¢ http://${{ secrets.SERVER_IP }} (HTTP redirect to HTTPS)"
        echo ""
        echo "‚úÖ Deployment verification completed"

  # ==================== POST-DEPLOYMENT ====================
  post_deploy:
    name: üìä Post-Deployment
    runs-on: ubuntu-latest
    needs: [validate, security, build, deploy]
    if: always()
    timeout-minutes: 10
    
    steps:
    - name: Checkout for git info
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
    
    - name: Generate deployment report
      env:
        DEPLOY_RESULT: ${{ needs.deploy.result }}
        BUILD_ID: ${{ needs.build.outputs.build_id }}
        BUILD_VERSION: ${{ needs.build.outputs.version }}
        SERVER_IP: ${{ secrets.SERVER_IP }}
        DOMAIN: ${{ secrets.DOMAIN }}
        DEPLOY_PATH: ${{ env.DEPLOY_PATH }}
        VALIDATE_RESULT: ${{ needs.validate.result }}
        SECURITY_RESULT: ${{ needs.security.result }}
        BUILD_RESULT: ${{ needs.build.result }}
        GITHUB_SERVER_URL: ${{ github.server_url }}
        GITHUB_REPOSITORY: ${{ github.repository }}
        GITHUB_RUN_ID: ${{ github.run_id }}
      run: |
        echo "üìä Generating deployment report..."
        
        # –°–æ–±–∏—Ä–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        DEPLOYMENT_TIME=$(date -u +"%Y-%m-%dT%H:%M:%SZ")
        GIT_COMMIT=$(git log -1 --pretty=format:"%H")
        GIT_AUTHOR=$(git log -1 --pretty=format:"%an")
        GIT_MESSAGE=$(git log -1 --pretty=format:"%s")
        BRANCH="${GITHUB_REF#refs/heads/}"
        
        cat > deployment-report.md << EOF
        # Deployment Report
        
        ## Summary
        - **Application**: birthday-invitation
        - **Environment**: Production
        - **Status**: $DEPLOY_RESULT
        - **Deployed At**: $DEPLOYMENT_TIME
        
        ## Build Information
        - **Build ID**: $BUILD_ID
        - **Version**: $BUILD_VERSION
        - **Commit**: $GIT_COMMIT
        - **Author**: $GIT_AUTHOR
        - **Message**: $GIT_MESSAGE
        - **Branch**: $BRANCH
        
        ## Deployment Details
        - **Server**: $SERVER_IP
        - **Domain**: $DOMAIN
        - **Deploy Path**: $DEPLOY_PATH
        - **Backup Created**: Yes
        
        ## Quality Gates
        - **Validation**: $VALIDATE_RESULT
        - **Security Scan**: $SECURITY_RESULT
        - **Build**: $BUILD_RESULT
        - **Deploy**: $DEPLOY_RESULT
        
        ## Links
        - **Application**: https://$DOMAIN
        - **Repository**: $GITHUB_SERVER_URL/$GITHUB_REPOSITORY
        - **Workflow Run**: $GITHUB_SERVER_URL/$GITHUB_REPOSITORY/actions/runs/$GITHUB_RUN_ID
        
        ## Next Steps
        1. Monitor application logs
        2. Test critical functionality
        3. Update monitoring dashboards
        EOF
        
        echo "‚úÖ Deployment report generated"
        cat deployment-report.md
    
    - name: Send deployment notification
      env:
        BUILD_STATUS: ${{ needs.build.result }}
        DEPLOY_STATUS: ${{ needs.deploy.result }}
        APP_NAME: ${{ env.APP_NAME }}
        BUILD_VERSION: ${{ needs.build.outputs.version }}
        BUILD_ID: ${{ needs.build.outputs.build_id }}
        SERVER_IP: ${{ secrets.SERVER_IP }}
        DOMAIN: ${{ secrets.DOMAIN }}
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        VALIDATE_RESULT: ${{ needs.validate.result }}
        SECURITY_RESULT: ${{ needs.security.result }}
        BUILD_RESULT: ${{ needs.build.result }}
        DEPLOY_RESULT: ${{ needs.deploy.result }}
        GITHUB_SERVER_URL: ${{ github.server_url }}
        GITHUB_REPOSITORY: ${{ github.repository }}
        GITHUB_RUN_ID: ${{ github.run_id }}
      run: |
        echo "üì® Sending deployment notification..."
        
        # –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–º–º–∏—Ç–µ
        COMMIT_SHA="${GITHUB_SHA:0:7}"
        COMMIT_MESSAGE=$(git log -1 --pretty=%B | head -n1)
        COMMIT_AUTHOR=$(git log -1 --pretty=%an)
        BRANCH="${GITHUB_REF#refs/heads/}"
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∏ –∏–∫–æ–Ω–∫–∏
        if [ "$BUILD_STATUS" = "success" ] && [ "$DEPLOY_STATUS" = "success" ]; then
          EMOJI="üéâ"
          STATUS_TEXT="<b>–£–°–ü–ï–®–ù–û</b> ‚úÖ"
          STATUS_ICON="üü¢"
        elif [ "$DEPLOY_STATUS" = "failure" ]; then
          EMOJI="‚ùå"
          STATUS_TEXT="<b>–û–®–ò–ë–ö–ê –î–ï–ü–õ–û–Ø</b> üî¥"
          STATUS_ICON="üî¥"
        elif [ "$BUILD_STATUS" = "failure" ]; then
          EMOJI="üö®"
          STATUS_TEXT="<b>–û–®–ò–ë–ö–ê –°–ë–û–†–ö–ò</b> üü†"
          STATUS_ICON="üü†"
        else
          EMOJI="‚ö†Ô∏è"
          STATUS_TEXT="<b>–ù–ï–ò–ó–í–ï–°–¢–ù–û</b> ‚ö™"
          STATUS_ICON="‚ö™"
        fi
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–≤–æ–π–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏ –¥–ª—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
        cat > message.txt << EOF
        $EMOJI <b>–î–µ–ø–ª–æ–π $APP_NAME</b>
        
        $STATUS_ICON –°—Ç–∞—Ç—É—Å: $STATUS_TEXT
        üì¶ –í–µ—Ä—Å–∏—è: <code>$BUILD_VERSION</code>
        üè∑Ô∏è –°–±–æ—Ä–∫–∞: <code>$BUILD_ID</code>
        
        üìù <b>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–º–∏—Ç–µ:</b>
        ‚îî‚îÄ –í–µ—Ç–∫–∞: <code>$BRANCH</code>
        ‚îî‚îÄ –ö–æ–º–º–∏—Ç: <code>$COMMIT_SHA</code>
        ‚îî‚îÄ –ê–≤—Ç–æ—Ä: $COMMIT_AUTHOR
        ‚îî‚îÄ –°–æ–æ–±—â–µ–Ω–∏–µ: $COMMIT_MESSAGE
        
        üåê <b>–î–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é:</b>
        ‚Ä¢ https://$DOMAIN
        ‚Ä¢ http://$SERVER_IP
        
        üîß <b>–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è:</b>
        ‚Ä¢ https://$DOMAIN/health
        ‚Ä¢ https://$DOMAIN/version
        
        üìä <b>–°—Ç–∞—Ç—É—Å—ã:</b>
        ‚Ä¢ –í–∞–ª–∏–¥–∞—Ü–∏—è: $VALIDATE_RESULT
        ‚Ä¢ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: $SECURITY_RESULT
        ‚Ä¢ –°–±–æ—Ä–∫–∞: $BUILD_RESULT
        ‚Ä¢ –î–µ–ø–ª–æ–π: $DEPLOY_RESULT
        
        üïê <i>$(date '+%d.%m.%Y %H:%M:%S')</i>
        EOF
        
        # –ß–∏—Ç–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
        MESSAGE=$(cat message.txt)
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Telegram
        echo "Sending to Telegram..."
        
        curl -s -X POST "https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/sendMessage" \
          -H "Content-Type: application/json" \
          -d "{
            \"chat_id\": \"$TELEGRAM_CHAT_ID\",
            \"text\": \"$(echo "$MESSAGE" | sed 's/"/\\"/g' | sed ':a;N;$!ba;s/\\n/\\\\n/g')\",
            \"parse_mode\": \"HTML\",
            \"disable_web_page_preview\": true,
            \"reply_markup\": {
              \"inline_keyboard\": [
                [
                  {\"text\": \"üåê –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ\", \"url\": \"https://$DOMAIN\"},
                  {\"text\": \"üìä –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏\", \"url\": \"$GITHUB_SERVER_URL/$GITHUB_REPOSITORY/actions/runs/$GITHUB_RUN_ID\"}
                ]
              ]
            }
          }"
        
        echo "‚úÖ Notification sent to Telegram"
        rm -f message.txt
  # ==================== CLEANUP ====================
  cleanup:
    name: üßπ Cleanup
    runs-on: ubuntu-latest
    needs: [post_deploy, build, validate, security, deploy, ]
    if: always()
    
    steps:
    - name: Cleanup old artifacts
      uses: actions/github-script@v7
      with:
        script: |
          // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã (–æ—Å—Ç–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5)
          const artifacts = await github.rest.actions.listArtifactsForRepo({
            owner: context.repo.owner,
            repo: context.repo.repo,
            per_page: 100
          });
          
          const buildArtifacts = artifacts.data.artifacts
            .filter(artifact => artifact.name.startsWith('build-'))
            .sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
          
          // –û—Å—Ç–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
          const artifactsToDelete = buildArtifacts.slice(5);
          
          for (const artifact of artifactsToDelete) {
            console.log(`Deleting old artifact: ${artifact.name}`);
            await github.rest.actions.deleteArtifact({
              owner: context.repo.owner,
              repo: context.repo.repo,
              artifact_id: artifact.id
            });
          }
    
    - name: Summary
      if: always()
      run: |
        echo "üìã ===== DEPLOYMENT PIPELINE SUMMARY ====="
        echo ""
        echo "üèóÔ∏è  Application: birthday-invitation"
        echo "üöÄ Trigger: ${{ github.event_name }}"
        echo "üë§ Actor: ${{ github.actor }}"
        echo "üåø Branch: ${GITHUB_REF#refs/heads/}"
        echo ""
        echo "üìä Job Results:"
        echo "  üîç Validate: ${{ needs.validate.result }}"
        echo "  üîí Security: ${{ needs.security.result }}"
        echo "  üèóÔ∏è  Build: ${{ needs.build.result }}"
        echo "  üöÄ Deploy: ${{ needs.deploy.result }}"
        echo "  üìä Post-Deploy: ${{ needs.post_deploy.result }}"
        echo ""
        echo "üåê Application URL: https://${{ secrets.DOMAIN }}"
        echo "üìÅ Build ID: ${{ needs.build.outputs.build_id }}"
        echo ""
        
        if [ "${{ job.status }}" = "success" ]; then
          echo "‚úÖ Deployment pipeline completed successfully!"
          echo "üéâ Your application is now live!"
        else
          echo "‚ùå Deployment pipeline failed!"
          echo "üîç Check the logs above for details."
        fi